define("#jsonform/1.0.0/jsonform",["#/jsv/4.0.2/jsv","#/underscore/1.4.3/underscore"],function(a,b,c){c.exports=function(c){b.JSONFormValidator=a("#/jsv/4.0.2/jsv").JSV,function(b,c,d,e,f){b&&(e=a("#/underscore/1.4.3/underscore"));var g=/\[([0-9]*)\](?=\.|$)/g,h=/\[([0-9]*)\](?:\.|$)/,i={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},j={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},k={util:{}},l=function(a){return a?(""+a).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""},m=function(a){return a.replace(/([\!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;<\=\>\?\@\[\\\]\^\`\{\|\}\~])/g,"\\$1")},n=function(a){var b=function(a,b){b.find("> .active").removeClass("active"),a.addClass("active")},c=function(a,b){a.find("input, textarea, select").removeAttr("disabled"),a.parent().children(":not([data-idx="+b+"])").find("input, textarea, select").attr("disabled","disabled")},e=function(a){var h,e=d("option:selected",d(this)),f=d(this),g=e.attr("data-idx")||e.attr("value");a.preventDefault(),e.hasClass("active")||(h=d(this).parents(".tabbable").eq(0).find(".tab-content [data-idx="+g+"]"),b(e,f),b(h,h.parent()),c(h,g))},f=function(a){d("a",d(this));var f=d(this).parents(".tabbable").first().find(".tab-content").first(),g=d(this).index(),h=f.find("[data-idx="+g+"]");a.preventDefault(),b(d(this),d(this).parent()),b(h,h.parent()),d(this).parent().hasClass("jsonform-alternative")&&c(h,g)};a.each(function(){d(this).delegate("select.nav","change",e),d(this).find("select.nav").each(function(){d(this).val(d(this).find(".active").attr("value"));var a=d(this).find("option:selected").attr("data-idx")||d(this).find("option:selected").attr("value"),b=d(this).parents(".tabbable").eq(0).find(".tab-content [data-idx="+a+"]");c(b,a)}),d(this).delegate("ul.nav li","click",f),d(this).find("ul.nav li.active").click()})};k.fieldTemplate=function(a){return'<div class="control-group jsonform-error-<%= keydash %> <%= elt.htmlClass ? elt.htmlClass : "" %>"><% if (node.title && !elt.notitle) { %><label class="control-label" for="<%= node.id %>"><%= node.title %></label><% } %><div class="controls"><% if (node.prepend || node.append) { %><div class="<% if (node.prepend) { %>input-prepend<% } %><% if (node.append) { %> input-append<% } %>"><% if (node.prepend) { %><span class="add-on"><%= node.prepend %></span><% } %><% } %>'+a+"<% if (node.append) { %>"+'<span class="add-on"><%= node.append %></span>'+"<% } %>"+"<% if (node.prepend || node.append) { %>"+"</div>"+"<% } %>"+"<% if (node.description) { %>"+'<span class="help-inline"><%= node.description %></span>'+"<% } %>"+'<span class="help-block jsonform-errortext" style="display:none;"></span>'+"</div></div>"};var o='<% if (value.type=="image") { %><img class="jsonform-preview" id="jsonformpreview-<%= id %>" src="<%= value.url %>" /><% } else { %><a href="<%= value.url %>"><%= value.name %></a> (<%= Math.ceil(value.size/1024) %>kB)<% } %><br/>';k.elementTypes={none:{template:""},root:{template:"<div><%= children %></div>"},text:{template:'<input class="input-xlarge xlarge" type="text" name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>"<%= (node.disabled? " disabled" : "")%> />',fieldtemplate:!0,inputfield:!0},password:{template:'<input class="input-xlarge xlarge" type="password" name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>"<%= (node.disabled? " disabled" : "")%> />',fieldtemplate:!0,inputfield:!0},color:{template:'<input class="input-xlarge xlarge" type="text" name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>"<%= (node.disabled? " disabled" : "")%> />',fieldtemplate:!0,inputfield:!0,onInsert:function(a,b){d(b.el).find("#"+m(b.id)).spectrum({preferredFormat:"hex",showInput:!0})}},textarea:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "150px" %>;width:<%= elt.width || "100%" %>;"<%= (node.disabled? " disabled" : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0},wysihtml5:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "300px" %>;width:<%= elt.width || "100%" %>;"><%= value %></textarea>',fieldtemplate:!0,inputfield:!0,onInsert:function(a,b){var c=function(){d(b.el).data("wysihtml5")||(d(b.el).data("wysihtml5_loaded",!0),d(b.el).find("#"+m(b.id)).wysihtml5({html:!0,link:!0,"font-styles":!0,image:!0}))};if(window.jsonform_wysihtml5_setup)return window.jsonform_wysihtml5_setup(c),void 0;var e=window.setInterval(function(){window.wysihtml5&&(window.clearInterval(e),c())},1e3)}},ace:{template:'<div id="<%= id %>" style="position:relative;height:<%= elt.height || "300px" %>;"><div id="<%= id %>__ace" style="width:<%= elt.width || "100%" %>;height:<%= elt.height || "300px" %>;"></div><input type="hidden" name="<%= node.name %>" id="<%= id %>__hidden" value="<%= escape(value) %>"/></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(a,b){var c=function(){var a=b.formElement||{},c=window.ace,f=c.edit(d(b.el).find("#"+m(b.id)+"__ace").get(0)),g="#"+m(b.id)+"__hidden";if(f.getSession().setNewLineMode("unix"),f.renderer.setShowPrintMargin(!1),f.setTheme("ace/theme/"+(a.aceTheme||"twilight")),a.aceMode){var h=c.require("ace/mode/"+a.aceMode).Mode;f.getSession().setMode(new h)}f.getSession().setTabSize(2),f.getSession().setValue(b.value||"");var i=e.debounce(function(){d(b.el).find(g).val(f.getSession().getValue()),d(b.el).find(g).change()},600);f.getSession().on("change",i),f.on("blur",function(){d(b.el).find(g).change(),d(b.el).find(g).trigger("blur")}),f.on("focus",function(){d(b.el).find(g).trigger("focus")})};if(window.jsonform_ace_setup)return window.jsonform_ace_setup(c),void 0;var f=window.setInterval(function(){window.ace&&(window.clearInterval(f),c())},1e3)}},checkbox:{template:'<label class="checkbox"><input type="checkbox" id="<%= id %>" name="<%= node.name %>" value="1" <% if (value) {%>checked<% } %><%= (node.disabled? " disabled" : "")%> /><span><%= node.inlinetitle || "" %></span></label>',fieldtemplate:!0,inputfield:!0,getElement:function(a){return d(a).parent().get(0)}},file:{template:'<input class="input-file" id="<%= id %>" name="<%= node.name %>" type="file" />',fieldtemplate:!0,inputfield:!0},"file-hosted-public":{template:"<span><% if (value && (value.type||value.url)) { %>"+o+'<% } %><input class="input-file" id="_transloadit_<%= id %>" type="file" name="<%= transloaditname %>" /><input data-transloadit-name="_transloadit_<%= transloaditname %>" type="hidden" id="<%= id %>" name="<%= node.name %>" value=\'<%= escape(JSON.stringify(node.value)) %>\' /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(a){return d(a).parent().get(0)},onBeforeRender:function(a,b){b.ownerTree._transloadit_generic_public_index?b.ownerTree._transloadit_generic_public_index++:b.ownerTree._transloadit_generic_public_index=1,a.transloaditname="_transloadit_jsonform_genericupload_public_"+b.ownerTree._transloadit_generic_public_index,b.ownerTree._transloadit_generic_elts||(b.ownerTree._transloadit_generic_elts={}),b.ownerTree._transloadit_generic_elts[a.transloaditname]=b},onChange:function(a,b){if(b.ownerTree._transloadit_bound)return!1;b.ownerTree._transloadit_bound=!0;var c=d(b.ownerTree.domRoot);c.transloadit({autoSubmit:!1,wait:!0,onSuccess:function(a){if(a.results[":original"])for(var e=0;a.results[":original"].length>e;e++){var g=a.results[":original"][e];d("#"+m(b.ownerTree._transloadit_generic_elts[g.field].id),c).val(f.stringify(g))}b.ownerTree._transloadit_bound=!1,c.unbind("submit.transloadit"),setTimeout(function(){b.ownerTree.submit()},10)},onError:function(a){console.log("Assembly error",a)}})},onSubmit:function(a,b){return b.ownerTree._transloadit_bound?!1:!0}},"file-transloadit":{template:"<span><% if (value && (value.type||value.url)) { %>"+o+'<% } %><input class="input-file" id="_transloadit_<%= id %>" type="file" name="_transloadit_<%= node.name %>" /><input type="hidden" id="<%= id %>" name="<%= node.name %>" value=\'<%= escape(JSON.stringify(node.value)) %>\' /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(a){return d(a).parent().get(0)},onChange:function(a,b){if(b.ownerTree._transloadit_bound)return!1;b.ownerTree._transloadit_bound=!0;var c=d(b.ownerTree.domRoot);c.transloadit({autoSubmit:!1,wait:!0,onSuccess:function(a){if(a.results[":original"])for(var e=0;a.results[":original"].length>e;e++){var g=a.results[":original"][e];d("input[name='"+g.field.replace(/^_transloadit_/,"")+"']",c).val(f.stringify(g))}b.ownerTree._transloadit_bound=!1,c.unbind("submit.transloadit"),setTimeout(function(){b.ownerTree.submit()},10)},onError:function(a){console.log("Assembly error",a)}})},onSubmit:function(a,b){return b.ownerTree._transloadit_bound?!1:!0}},select:{template:'<select name="<%= node.name %>" id="<%= id %>" <%= (node.disabled? " disabled" : "")%>> <% _.each(node.options, function(key, val) { if(key instanceof Object) { if (value === key.value) { %> <option selected value="<%= key.value %>"><%= key.title %></option> <% } else { %> <option value="<%= key.value %>"><%= key.title %></option> <% }} else { if (value === key) { %> <option selected value="<%= key %>"><%= key %></option> <% } else { %><option value="<%= key %>"><%= key %></option> <% }}}); %> </select>',fieldtemplate:!0,inputfield:!0},imageselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn<% if (buttonClass && node.value) { %> <%= buttonClass %><% } %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><img src="<% if (!node.value.match(/^https?:/)) { %><%= prefix %><% } %><%= node.value %><%= suffix %>" alt="" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu navbar" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } %>" style="max-width:<%= width %>px;max-height:<%= height %>px"><% if (key instanceof Object) { %><img src="<% if (!key.value.match(/^https?:/)) { %><%= prefix %><% } %><%= key.value %><%= suffix %>" alt="<%= key.title %>" /></a><% } else { %><img src="<% if (!key.match(/^https?:/)) { %><%= prefix %><% } %><%= key %><%= suffix %>" alt="" /><% } %></a> <% }); %></div><div class="pagination-right"><a class="btn">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(a,b){var c=b.formElement||{},d=null,e=c.imageSelectorColumns||5;a.buttonTitle=c.imageSelectorTitle||"Select...",a.prefix=c.imagePrefix||"",a.suffix=c.imageSuffix||"",a.width=c.imageWidth||32,a.height=c.imageHeight||32,a.buttonClass=c.imageButtonClass||!1,b.options.length>e?(d=Math.ceil(b.options.length/e),a.columns=Math.ceil(b.options.length/d)):a.columns=e},getElement:function(a){return d(a).parent().get(0)},onInsert:function(a,b){d(b.el).on("click",".dropdown-menu a",function(a){a.preventDefault(),a.stopPropagation();var c="img"===a.target.nodeName.toLowerCase()?d(a.target):d(a.target).find("img"),e=c.attr("src"),f=b.formElement||{},g=f.imagePrefix||"",h=f.imageSuffix||"",i=f.imageWidth||32,j=f.imageHeight||32;e?(0===e.indexOf(g)&&(e=e.substring(g.length)),e=e.substring(0,e.length-h.length),d(b.el).find("input").attr("value",e),d(b.el).find('a[data-toggle="dropdown"]').addClass(f.imageButtonClass).attr("style","max-width:"+i+"px;max-height:"+j+"px").html('<img src="'+(e.match(/^https?:/)?"":g)+e+h+'" alt="" />')):(d(b.el).find("input").attr("value",""),d(b.el).find('a[data-toggle="dropdown"]').removeClass(f.imageButtonClass).removeAttr("style").html(f.imageSelectorTitle||"Select..."))})}},radios:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><label class="radio"><input type="radio" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked="checked" <% } %> name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>"<%= (node.disabled? " disabled" : "")%>/><span><%= (key instanceof Object ? key.title : key) %></span></label> <% }); %></div>',fieldtemplate:!0,inputfield:!0},radiobuttons:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><label class="radio btn"><input type="radio" style="position:absolute;left:-9999px;" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked="checked" <% } %> name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>" /><span><%= (key instanceof Object ? key.title : key) %></span></label> <% }); %></div>',fieldtempate:!0,inputfield:!0,onInsert:function(a,b){var c="active",e=b.formElement||{};e.activeClass&&(c+=" "+e.activeClass),d(b.el).find("label").on("click",function(){d(this).parent().find("label").removeClass(c),d(this).addClass(c)})}},checkboxes:{template:"<div><%= choiceshtml %></div>",fieldtemplate:!0,inputfield:!0,onBeforeRender:function(a,b){var c=null,d=null,f='<label class="checkbox"><input type="checkbox" <% if (value) { %> checked="checked" <% } %> name="<%= name %>" value="1"<%= (node.disabled? " disabled" : "")%>><span><%= title %></span></label>';b&&b.schemaElement&&b.schemaElement.items&&(c=b.schemaElement.items["enum"]||b.schemaElement.items[0]["enum"],c&&(d="",e.each(c,function(a,c){d+=e.template(f,{name:b.key+"["+c+"]",value:e.include(b.value,a),title:b.formElement.titleMap?b.formElement.titleMap[a]:a,node:b},i)}),a.choiceshtml=d))}},array:{template:'<div id="<%= id %>"><ul class="_jsonform-array-ul" style="list-style-type:none;"><%= children %></ul><span class="_jsonform-array-buttons"><a href="#" class="btn _jsonform-array-addmore"><i class="icon-plus-sign" title="Add new"></i></a> <a href="#" class="btn _jsonform-array-deletelast"><i class="icon-minus-sign" title="Delete last"></i></a></span></div>',fieldtemplate:!0,array:!0,childTemplate:function(a){return d("").sortable?'<li data-idx="<%= node.childPos %>"><span class="draggable line"><i class="icon-list" title="Move item"></i></span>'+a+"</li>":'<li data-idx="<%= node.childPos %>">'+a+"</li>"},onInsert:function(a,b){var c=d(b.el).find("#"+m(b.id)),e=b.getArrayBoundaries(),f=function(a,e){if(a!==e){var f=e>a?1:-1,g=0,h=d("> ul",c);for(g=a;g!==e;g+=f)b.children[g].switchValuesWith(b.children[g+f]),b.children[g].render(h.get(0)),b.children[g+f].render(h.get(0));var i=d(b.children[a].el),j=d(b.children[e].el);i.detach(),j.detach(),e>a?(0===a?h.prepend(i):d(b.children[a-1].el).after(i),d(b.children[e-1].el).after(j)):(0===e?h.prepend(j):d(b.children[e-1].el).after(j),d(b.children[a-1].el).after(i))}};d("> span > a._jsonform-array-addmore",c).click(function(a){a.preventDefault(),a.stopPropagation();var f=b.children.length;return e.maxItems>=0&&(b.children.length>e.maxItems-2&&d("> span > a._jsonform-array-addmore",c).addClass("disabled"),b.children.length>e.maxItems-1)?!1:(b.insertArrayItem(f,d("> ul",c).get(0)),e.minItems>0&&b.children.length>e.minItems-1&&d("> span > a._jsonform-array-deletelast",c).removeClass("disabled"),void 0)});var g=d("> ul > li",c).length;if(e.minItems>=0&&e.minItems>g){for(var h=0;e.minItems-1>h&&d("> ul > li",c).length<e.minItems;h++)b.insertArrayItem(g,d("> ul",c).get(0));d("> span > a._jsonform-array-deletelast",c).addClass("disabled")}d("> span > a._jsonform-array-deletelast",c).click(function(a){var f=b.children.length-1;return a.preventDefault(),a.stopPropagation(),e.minItems>0&&(b.children.length<e.minItems+2&&d("> span > a._jsonform-array-deletelast",c).addClass("disabled"),b.children.length<=e.minItems)?!1:(b.deleteArrayItem(f),e.maxItems>=0&&e.maxItems-1>=f&&d("> span > a._jsonform-array-addmore",c).removeClass("disabled"),void 0)}),d(b.el).sortable&&(d("> ul",c).sortable(),d("> ul",c).bind("sortstop",function(a,b){var c=d(b.item).data("idx"),e=d(b.item).index();f(c,e)}))}},tabarray:{template:'<div id="<%= id %>"><div class="tabbable tabs-left"><ul class="nav nav-tabs"><%= tabs %></ul><div class="tab-content"><%= children %></div></div><a href="#" class="btn _jsonform-array-addmore"><i class="icon-plus-sign" title="Add new"></i></a> <a href="#" class="btn _jsonform-array-deleteitem"><i class="icon-minus-sign" title="Delete item"></i></a></div>',fieldtemplate:!0,array:!0,childTemplate:function(a){return'<div data-idx="<%= node.childPos %>" class="tab-pane">'+a+"</div>"},onBeforeRender:function(a,b){var c="";e.each(b.children,function(a,b){var d=a.legend||a.title||"Item "+(b+1);c+='<li data-idx="'+b+'"'+(0===b?' class="active"':"")+'><a class="draggable tab" data-toggle="tab">'+l(d)+"</a></li>"}),a.tabs=c},onInsert:function(a,b){var c=d(b.el).find("#"+m(b.id)),f=b.getArrayBoundaries(),g=function(a,e){if(a!==e){var f=e>a?1:-1,g=0,h=d("> .tabbable > .tab-content",c).get(0);for(g=a;g!==e;g+=f)b.children[g].switchValuesWith(b.children[g+f]),b.children[g].render(h),b.children[g+f].render(h)}},h=function(a){var f="",g=!1;void 0===a&&(a=d("> .tabbable > .nav-tabs .active",c).data("idx"),a?a=parseInt(a,10):(g=!0,a=0)),a>=b.children.length&&(a=b.children.length-1),e.each(b.children,function(a,b){var c=a.legend||a.title||"Item "+(b+1);f+='<li data-idx="'+b+'">'+'<a class="draggable tab" data-toggle="tab">'+l(c)+"</a></li>"}),d("> .tabbable > .nav-tabs",c).html(f),g&&d('> .tabbable > .nav-tabs [data-idx="0"]',c).addClass("active"),d('> .tabbable > .nav-tabs [data-toggle="tab"]',c).eq(a).click()};if(d("> a._jsonform-array-deleteitem",c).click(function(a){var e=d("> .tabbable > .nav-tabs .active",c).data("idx");return a.preventDefault(),a.stopPropagation(),f.minItems>0&&(b.children.length<f.minItems+1&&d("> a._jsonform-array-deleteitem",c).addClass("disabled"),b.children.length<f.minItems)?!1:(b.deleteArrayItem(e),h(),b.children.length<f.minItems+1&&d("> a._jsonform-array-deleteitem",c).addClass("disabled"),f.maxItems>=0&&b.children.length<=f.maxItems&&d("> a._jsonform-array-addmore",c).removeClass("disabled"),void 0)}),d("> a._jsonform-array-addmore",c).click(function(a){var e=b.children.length;return f.maxItems>=0&&(b.children.length>f.maxItems-2&&d("> a._jsonform-array-addmore",c).addClass("disabled"),b.children.length>f.maxItems-1)?!1:(a.preventDefault(),a.stopPropagation(),b.insertArrayItem(e,d("> .tabbable > .tab-content",c).get(0)),h(e),f.minItems>0&&e>f.minItems-1&&d("> a._jsonform-array-deleteitem",c).removeClass("disabled"),void 0)}),d(b.el).on("legendUpdated",function(a){h(),a.preventDefault(),a.stopPropagation()}),d(b.el).sortable&&(d("> .tabbable > .nav-tabs",c).sortable({containment:b.el,tolerance:"pointer"}),d("> .tabbable > .nav-tabs",c).bind("sortstop",function(a,b){var c=d(b.item).data("idx"),e=d(b.item).index();g(c,e),h(e)})),f.minItems>=0){for(var i=0;f.minItems-1>i;i++)d("> a._jsonform-array-addmore",c).click();d("> a._jsonform-array-deleteitem",c).addClass("disabled"),h()}f.maxItems>=0&&b.children.length>=f.maxItems&&d("> a._jsonform-array-addmore",c).addClass("disabled"),f.minItems>=0&&b.children.length<=f.minItems&&d("> a._jsonform-array-deleteitem",c).addClass("disabled")}},help:{template:'<span class="help-block" style="padding-top:5px"><%= elt.helpvalue %></span>',fieldtemplate:!0},msg:{template:"<%= elt.msg %>"},fieldset:{template:'<fieldset class="control-group jsonform-error-<%= keydash %> <% if (elt.expandable) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>" <% if (id) { %> id="<%= id %>"<% } %>><% if (node.title || node.legend) { %><legend><%= node.title || node.legend %></legend><% } %><% if (elt.expandable) { %><div class="control-group"><% } %><%= children %><% if (elt.expandable) { %></div><% } %></fieldset>'},advancedfieldset:{template:'<fieldset<% if (id) { %> id="<%= id %>"<% } %> class="expandable <%= elt.htmlClass?elt.htmlClass:"" %>"><legend>Advanced options</legend><div class="control-group"><%= children %></div></fieldset>'},authfieldset:{template:'<fieldset<% if (id) { %> id="<%= id %>"<% } %> class="expandable <%= elt.htmlClass?elt.htmlClass:"" %>"><legend>Authentication settings</legend><div class="control-group"><%= children %></div></fieldset>'},submit:{template:'<input type="submit" <% if (id) { %> id="<%= id %>" <% } %> class="btn btn-primary <%= elt.htmlClass?elt.htmlClass:"" %>" value="<%= value || node.title %>"<%= (node.disabled? " disabled" : "")%>/>'},button:{template:' <button <% if (id) { %> id="<%= id %>" <% } %> class="btn <%= elt.htmlClass?elt.htmlClass:"" %>"><%= node.title %></button> '},actions:{template:'<div class="form-actions <%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},hidden:{template:'<input type="hidden" id="<%= id %>" name="<%= node.name %>" value="<%= escape(value) %>" />',inputfield:!0},selectfieldset:{template:'<fieldset class="tab-container <%= elt.htmlClass?elt.htmlClass:"" %>"><% if (node.legend) { %><legend><%= node.legend %></legend><% } %><% if (node.formElement.key) { %><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><% } else { %><a id="<%= node.id %>"></a><% } %><div class="tabbable"><div class="control-group<%= node.formElement.hideMenu ? " hide" : "" %>"><% if (node.title && !elt.notitle) { %><label class="control-label" for="<%= node.id %>"><%= node.title %></label><% } %><div class="controls"><%= tabs %></div></div><div class="tab-content"><%= children %></div></div></fieldset>',inputfield:!0,getElement:function(a){return d(a).parent().get(0)},childTemplate:function(a){return'<div data-idx="<%= node.childPos %>" class="tab-pane<% if (node.active) { %> active<% } %>">'+a+"</div>"},onBeforeRender:function(a,b){var c=null,d=[];b.schemaElement&&(d=b.schemaElement["enum"]||[]),c=b.options?e.map(b.options,function(a,c){var f=b.children[c];return a instanceof Object?(a=e.extend({node:f},a),a.title=a.title||f.legend||f.title||"Option "+(f.childPos+1),a.value=a.value||d[c]||c,a):{title:a,value:d[f.childPos]||f.childPos,node:f}}):e.map(b.children,function(a){return{title:a.legend||a.title||"Option "+(a.childPos+1),value:d[a.childPos]||a.childPos,node:a}});var f=null;a.value&&(f=e.find(c,function(a){return a.value===b.value})),f||(f=e.find(c,function(a){return a.node.hasNonDefaultValue()})),f||(f=c[0]),f.node.active=!0,a.value=f.value,b.formElement;var h='<select class="nav"'+(b.disabled?" disabled":"")+">";return e.each(c,function(a,b){h+='<option data-idx="'+b+'" value="'+a.value+'"'+(a.node.active?' class="active"':"")+">"+l(a.title)+"</option>"}),h+="</select>",a.tabs=h,a},onInsert:function(a,b){d(b.el).find("select.nav").first().on("change",function(){var c=d(this).find("option:selected");d(b.el).find('input[type="hidden"]').first().val(c.attr("value"))})}},optionfieldset:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},section:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},questions:{template:'<div><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><%= children %></div>',fieldtempate:!0,inputfield:!0,getElement:function(a){return d(a).parent().get(0)},onInsert:function(a,b){b.children&&0!==b.children.length&&(e.each(b.children,function(a){d(a.el).hide()}),d(b.children[0].el).show())}},question:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><label class="radio<%= (node.formElement.optionsType === "radiobuttons") ? " btn" : "" %><%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %>"><input type="radio" <% if (node.formElement.optionsType === "radiobuttons") { %> style="position:absolute;left:-9999px;" <% } %>name="<%= node.id %>" value="<%= val %>"<%= (node.disabled? " disabled" : "")%>/><span><%= (key instanceof Object ? key.title : key) %></span></label> <% }); %></div>',fieldtemplate:!0,onInsert:function(a,b){var c="active",f=b.formElement||{};f.activeClass&&(c+=" "+f.activeClass),d(b.el).find('input[type="radio"]').on("change",function(){var f=null,g=b.options[d(this).val()];b.parentNode&&b.parentNode.el&&(d(this).parent().parent().find("label").removeClass(c),d(this).parent().addClass(c),d(b.el).nextAll().hide(),d(b.el).nextAll().find('input[type="radio"]').prop("checked",!1),g.value&&d(b.parentNode.el).find('input[type="hidden"]').val(g.value),g.next&&(f=e.find(b.parentNode.children,function(a){return a.formElement&&a.formElement.qid===g.next}),d(f.el).show(),d(f.el).nextAll().hide(),d(f.el).nextAll().find('input[type="radio"]').prop("checked",!1)),g.href&&(g.target?window.open(g.href,g.target):window.location=g.href),g.submit&&setTimeout(function(){b.ownerTree.submit()},0))})}}},k.util.getObjKey=function(a,b,c){for(var d=a,f=b.split("."),g=null,i=null,j=0;f.length>j;j++){if(null===d||"object"!=typeof d)return null;if(g=f[j],i=g.match(h)){if(g=g.replace(h,""),!e.isArray(d[g]))return null;d=d[g][parseInt(i[1],10)]}else d=c&&!d[g]&&e.isArray(d)&&d[0]?d[0][g]:d[g]}return c&&e.isArray(d)&&d[0]?d[0]:d},k.util.setObjKey=function(a,b,c){for(var d=a,f=b.split("."),g=null,i=null,j=0;f.length-1>j;j++)g=f[j],i=g.match(h),i?(g=g.replace(h,""),e.isArray(d[g])||(d[g]=[]),("object"!=typeof d[g][parseInt(i[1],10)]||null===d[g][parseInt(i[1],10)])&&(d[g][parseInt(i[1],10)]={}),d=d[g][parseInt(i[1],10)]):(("object"!=typeof d[g]||null===d[g])&&(d[g]={}),d=d[g]);g=f[f.length-1],i=g.match(h),i?(g=g.replace(h,""),e.isArray(d[g])||(d[g]=[]),d[g][parseInt(i[1],10)]=c):d[g]=c};var p=function(a,b){var c=b.replace(/\./g,".properties.").replace(/\[[0-9]*\](\.|$)/g,".items$1");return k.util.getObjKey(a,c,!0)},q=function(a,b){var c=0,d=0;if(!a)return null;if(b>0)for(;b>c;){if(d=a.indexOf("[]",d),-1===d)return a;d+=2,c+=1}return d=a.indexOf("[]",d),-1===d?a:a.substring(0,d)},r=function(a,b){var c=0;if(!a)return null;if(!b||0===b.length)return a;var d=a.replace(g,function(a){var f=a;return e.isUndefined(b[c])||e.isNull(b[c])||(f="["+b[c]+"]"),c+=1,f});return d},s=function(a,b,c,d,f){var g=null;d=d||{},d.idx=d.idx||(c?c[c.length-1]:1),d.value=d.value||"",d.getValue=d.getValue||function(b){return s(a,b,c,d,f)};var h=function(a,b){var c=null;return a&&a.length?(e.each(a,function(a){return c?void 0:a===b?(c={key:a},void 0):(e.isString(a)||(a.key===b?c=a:a.items&&(c=h(a.items,b))),void 0)}),c):null},i=h(a.form||[],b),l=p(a.schema.properties,b);return f&&a.value&&(g=k.util.getObjKey(a.value,r(b,c))),(g===void 0||null===g)&&(i&&i.value!==void 0?g=i.value:l&&(g=l["default"]||""),g&&-1!==g.indexOf("{{values.")&&(g=g.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}')),g&&(g=e.template(g,d,j))),g!==void 0&&null!==g&&i&&i.titleMap&&i.titleMap[g]&&(g=e.template(i.titleMap[g],d,j)),g&&e.isString(g)&&l&&l.maxLength&&g.length>l.maxLength&&(g=g.substr(0,l.maxLength-1)+"…"),g===void 0?null:g},t=function(){this.id=null,this.key=null,this.el=null,this.formElement=null,this.schemaElement=null,this.view=null,this.children=[],this.ownerTree=null,this.parentNode=null,this.childTemplate=null,this.legendChild=null,this.arrayPath=[],this.childPos=0};t.prototype.clone=function(a){var b=new t;return b.arrayPath=e.clone(this.arrayPath),b.ownerTree=this.ownerTree,b.parentNode=a||this.parentNode,b.formElement=this.formElement,b.schemaElement=this.schemaElement,b.view=this.view,b.children=e.map(this.children,function(a){return a.clone(b)}),this.childTemplate&&(b.childTemplate=this.childTemplate.clone(b)),b},t.prototype.hasNonDefaultValue=function(){if(this.formElement&&"hidden"==this.formElement.type)return!1;if(this.value&&!this.defaultValue)return!0;var a=e.find(this.children,function(a){return a.hasNonDefaultValue()});return!!a},t.prototype.appendChild=function(a){return a.parentNode=this,a.childPos=this.children.length,this.children.push(a),a},t.prototype.removeChild=function(){var a=this.children[this.children.length-1];if(a)return d(a.el).remove(),this.children.pop()},t.prototype.moveValuesTo=function(a){var b=this.getFormValues(a.arrayPath);a.resetValues(),a.computeInitialValues(b,!0)},t.prototype.switchValuesWith=function(a){var b=this.getFormValues(a.arrayPath),c=a.getFormValues(this.arrayPath);a.resetValues(),a.computeInitialValues(b,!0),this.resetValues(),this.computeInitialValues(c,!0)},t.prototype.resetValues=function(){var a=null;if(this.value=null,this.parentNode?(this.arrayPath=e.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],this.view&&this.view.inputfield)a=d(":input",this.el).serializeArray(),e.each(a,function(a){d('[name="'+m(a.name)+'"]',d(this.el)).val("")},this);else if(this.view&&this.view.array)for(;this.children.length>0;)this.removeChild();e.each(this.children,function(a){a.resetValues()})},t.prototype.setChildTemplate=function(a){this.childTemplate=a,a.parentNode=this},t.prototype.computeInitialValues=function(a,b){var c=this,d=null,f=1,g=0,h=this.ownerTree.formDesc.tpldata||{};if(this.parentNode?(this.arrayPath=e.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],h.idx=this.arrayPath.length>0?this.arrayPath[this.arrayPath.length-1]+1:this.childPos+1,h.value="",h.getValue=function(b){return s(c.ownerTree.formDesc,b,c.arrayPath,h,!!a)},this.formElement&&(this.formElement.id?this.id=r(this.formElement.id,this.arrayPath):this.view&&this.view.array?this.id=m(this.ownerTree.formDesc.prefix)+"-elt-counter-"+e.uniqueId():this.parentNode&&this.parentNode.view&&this.parentNode.view.array?this.id=m(this.ownerTree.formDesc.prefix)+"-elt-counter-"+e.uniqueId():("button"===this.formElement.type||"selectfieldset"===this.formElement.type||"question"===this.formElement.type||"buttonquestion"===this.formElement.type)&&(this.id=m(this.ownerTree.formDesc.prefix)+"-elt-counter-"+e.uniqueId()),this.formElement.key&&(this.key=r(this.formElement.key,this.arrayPath),this.keydash=this.key.replace(/\./g,"---")),this.name=r(this.formElement.name,this.arrayPath),e.each(["title","legend","description","append","prepend","inlinetitle","helpvalue","value","disabled"],function(a){e.isString(this.formElement[a])?(this[a]=-1!==this.formElement[a].indexOf("{{values.")?this.formElement[a].replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):r(this.formElement[a],this.arrayPath),this[a]&&(this[a]=e.template(this[a],h,j))):this[a]=this.formElement[a]},this),this.formElement.options&&(this.options=e.map(this.formElement.options,function(a){var b=null;return e.isObject(a)&&a.title?(b=-1!==a.title.indexOf("{{values.")?a.title.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):r(a.title,c.arrayPath),e.extend({},a,{value:a.value!==void 0?a.value:"",title:e.template(b,h,j)})):a}))),this.view&&this.view.inputfield&&this.schemaElement)a?k.util.getObjKey(a,this.key)&&(this.value=k.util.getObjKey(a,this.key)):b||!this.value&&this.schemaElement["default"]&&(this.value=this.schemaElement["default"],e.isString(this.value)&&(this.value=-1!==this.value.indexOf("{{values.")?this.value.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):r(this.value,this.arrayPath),this.value&&(this.value=e.template(this.value,h,j))),this.defaultValue=!0);else if(this.view&&this.view.array)for(f=0,a&&(f=this.getPreviousNumberOfItems(a,this.arrayPath)),0===f&&(f=1),g=0;f>g;g++)this.appendChild(this.childTemplate.clone());if(e.each(this.children,function(c){c.computeInitialValues(a,b)}),this.formElement&&this.formElement.valueInLegend)for(d=this;d;){if(d.parentNode&&d.parentNode.view&&d.parentNode.view.array&&(d.legendChild=this,d.formElement&&d.formElement.legend)){d.legend=r(d.formElement.legend,d.arrayPath),h.idx=d.arrayPath.length>0?d.arrayPath[d.arrayPath.length-1]+1:d.childPos+1,h.value=this.value||"",d.legend=e.template(d.legend,h,j);break}d=d.parentNode}},t.prototype.getPreviousNumberOfItems=function(a,b){var c=null,d=null,f=null;return a?this.view.inputfield&&this.schemaElement?(c=q(this.formElement.key,b.length),c=r(c,b),(d=k.util.getObjKey(a,c))?(f=e.map(this.children,function(c){return c.getPreviousNumberOfItems(a,b)
}),e.max([e.max(f)||0,d.length])):0):this.view.array?this.childTemplate.getPreviousNumberOfItems(a,b):(f=e.map(this.children,function(c){return c.getPreviousNumberOfItems(a,b)}),e.max(f)||0):0},t.prototype.getFormValues=function(a){var b={};if(!this.el)throw Error("formNode.getFormValues can only be called on nodes that are associated with a DOM element in the tree");var c=d(":input",this.el).serializeArray();a&&e.each(c,function(b){b.name=r(b.name,a)});for(var g=this.ownerTree.formDesc.schema,h=0;c.length>h;h++){var i=c[h].name,j=p(g.properties,i),l=null,m=null;if(j)if(j._jsonform_checkboxes_as_array&&(l=i.match(/\[([0-9]*)\]$/)))i=i.replace(/\[([0-9]*)\]$/,""),m=k.util.getObjKey(b,i)||[],"1"===c[h].value&&m.push(j["enum"][parseInt(l[1],10)]),k.util.setObjKey(b,i,m);else{if("boolean"===j.type&&(c[h].value="0"===c[h].value?!1:!!c[h].value),("number"===j.type||"integer"===j.type)&&e.isString(c[h].value)&&(c[h].value.length?isNaN(Number(c[h].value))||(c[h].value=Number(c[h].value)):c[h].value=void 0),"string"!==j.type||""!==c[h].value||j._jsonform_allowEmpty||(c[h].value=null),"object"===j.type&&e.isString(c[h].value)&&"{"===c[h].value.substring(0,1))try{c[h].value=f.parse(c[h].value)}catch(n){c[h].value={}}"object"!==j.type||"null"!==c[h].value&&""!==c[h].value||(c[h].value=null),c[h].name&&null!==c[h].value&&k.util.setObjKey(b,c[h].name,c[h].value)}}return b},t.prototype.render=function(a){var b=this.generate();this.setContent(b,a),this.enhance()},t.prototype.setContent=function(a,b){var c=d(a),e=b||(this.parentNode?this.parentNode.el:this.ownerTree.domRoot),f=null;this.el?d(this.el).replaceWith(c):(f=d(e).children().get(this.childPos),f?d(f).before(c):d(e).append(c)),this.el=c,this.updateElement(this.el)},t.prototype.updateElement=function(a){this.id&&(this.el=d("#"+m(this.id),a).get(0),this.view&&this.view.getElement&&(this.el=this.view.getElement(this.el)),this.fieldtemplate!==!1&&this.view&&this.view.fieldtemplate&&(this.el=d(this.el).parent().parent(),(this.prepend||this.prepend)&&(this.el=this.el.parent()),this.el=this.el.get(0)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(this.el=d(this.el).parent().get(0))),e.each(this.children,function(b){b.updateElement(this.el||a)})},t.prototype.generate=function(){var a={id:this.id,keydash:this.keydash,elt:this.formElement,schema:this.schemaElement,node:this,value:this.value||"",escape:l},b=null,c="";this.ownerTree.formDesc.onBeforeRender&&this.ownerTree.formDesc.onBeforeRender(a,this),this.view.onBeforeRender&&this.view.onBeforeRender(a,this),b=this.template?this.template:this.formElement&&this.formElement.template?this.formElement.template:this.view.template,this.fieldtemplate!==!1&&(this.fieldtemplate||this.view.fieldtemplate)&&(b=k.fieldTemplate(b)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(b=this.parentNode.view.childTemplate(b));var d="";return e.each(this.children,function(a){d+=a.generate()}),a.children=d,c=e.template(b,a,i)},t.prototype.enhance=function(){var a=this,b=null,c=null,f=e.clone(this.ownerTree.formDesc.tpldata)||{};this.formElement&&(this.view.onInsert&&this.view.onInsert({target:d(this.el)},this),b=this.handlers||this.formElement.handlers,c=this.onInsert||this.formElement.onInsert,c&&c({target:d(this.el)},this),b&&e.each(b,function(a,b){"insert"===b&&a({target:d(this.el)},this)},this),this.el&&(this.onChange&&d(this.el).bind("change",function(b){a.onChange(b,a)}),this.view.onChange&&d(this.el).bind("change",function(b){a.view.onChange(b,a)}),this.formElement.onChange&&d(this.el).bind("change",function(b){a.formElement.onChange(b,a)}),this.onClick&&d(this.el).bind("click",function(b){a.onClick(b,a)}),this.view.onClick&&d(this.el).bind("click",function(b){a.view.onClick(b,a)}),this.formElement.onClick&&d(this.el).bind("click",function(b){a.formElement.onClick(b,a)}),this.onKeyUp&&d(this.el).bind("keyup",function(b){a.onKeyUp(b,a)}),this.view.onKeyUp&&d(this.el).bind("keyup",function(b){a.view.onKeyUp(b,a)}),this.formElement.onKeyUp&&d(this.el).bind("keyup",function(b){a.formElement.onKeyUp(b,a)}),b&&e.each(b,function(b,c){"insert"!==c&&d(this.el).bind(c,function(c){b(c,a)})},this)),this.legendChild&&this.legendChild.formElement&&d(this.legendChild.el).bind("keyup",function(b){a.formElement&&a.formElement.legend&&a.parentNode&&(a.legend=r(a.formElement.legend,a.arrayPath),f.idx=a.arrayPath.length>0?a.arrayPath[a.arrayPath.length-1]+1:a.childPos+1,f.value=d(b.target).val(),a.legend=e.template(a.legend,f,j),d(a.parentNode.el).trigger("legendUpdated"))})),e.each(this.children,function(a){a.enhance()})},t.prototype.insertArrayItem=function(a,b){var c=0;void 0===a&&(a=this.children.length);var d=this.childTemplate.clone();for(this.appendChild(d),d.resetValues(),c=this.children.length-2;c>=a;c--)this.children[c].moveValuesTo(this.children[c+1]);for(this.children[a].resetValues(),this.children[a].computeInitialValues(),c=a;this.children.length>c;c++)this.children[c].render(b)},t.prototype.deleteArrayItem=function(a){var b=0;for(void 0===a&&(a=this.children.length-1),b=a;this.children.length-1>b;b++)this.children[b+1].moveValuesTo(this.children[b]),this.children[b].render();this.children.length>1?this.removeChild():(this.children[0].resetValues(),this.children[0].computeInitialValues(),this.children[0].render())},t.prototype.getArrayBoundaries=function(){var a={minItems:-1,maxItems:-1};if(!this.view||!this.view.array)return a;var b=function(a,c){var d=null,f={minItems:-1,maxItems:-1};return c=c||a,a.view&&a.view.array&&a!==c?f:a.key?(d=p(a.ownerTree.formDesc.schema.properties,a.key.replace(/\[[0-9]+\]/g,"[]").replace(/\[\][^\[\]]*$/,"")),d?{minItems:d.minItems||d.minLength||-1,maxItems:d.maxItems||d.maxLength||-1}:f):(e.each(a.children,function(a){var d=b(a,c);-1!==d.minItems&&(f.minItems=-1!==f.minItems?Math.max(f.minItems,d.minItems):d.minItems),-1!==d.maxItems&&(f.maxItems=-1!==f.maxItems?Math.min(f.maxItems,d.maxItems):d.maxItems)}),f)};return b(this)};var u=function(){this.eventhandlers=[],this.root=null,this.formDesc=null};u.prototype.initialize=function(a){a=a||{},this.formDesc=e.clone(a),this.formDesc.prefix=this.formDesc.prefix||"jsonform-"+e.uniqueId(),this.formDesc.schema&&!this.formDesc.schema.properties&&(this.formDesc.schema={properties:this.formDesc.schema}),this.formDesc.form=this.formDesc.form||["*",{type:"actions",items:[{type:"submit",value:"Submit"}]}],this.formDesc.form=e.isArray(this.formDesc.form)?this.formDesc.form:[this.formDesc.form],this.root=new t,this.root.ownerTree=this,this.root.view=k.elementTypes.root,this.buildTree(),this.computeInitialValues()},u.prototype.buildTree=function(){e.each(this.formDesc.form,function(a){"*"===a?e.each(this.formDesc.schema.properties,function(a,b){this.root.appendChild(this.buildFromLayout({key:b}))},this):(e.isString(a)&&(a={key:a}),this.root.appendChild(this.buildFromLayout(a)))},this)},u.prototype.buildFromLayout=function(a){var c=null,d=new t,f=null,g=null;if(a=e.clone(a),a.items&&(a.items=e.isArray(a.items)?e.map(a.items,e.clone):[e.clone(a.items)]),a.key){if(c=p(this.formDesc.schema.properties,a.key),!c)throw Error('The JSONForm object references the schema key "'+a.key+'" but that key does not exist in the JSON schema');if(this.formDesc.onElementSchema&&this.formDesc.onElementSchema(a,c),a.name=a.name||a.key,a.title=a.title||c.title,a.description=a.description||c.description,a.id||(a.id=m(this.formDesc.prefix)+"-elt-"+a.key),a.allowEmpty&&(c._jsonform_allowEmpty=!0),a.type||(a.type="string"===c.type&&"color"===c.format?"color":"number"!==c.type&&"integer"!==c.type&&"string"!==c.type&&"any"!==c.type||c["enum"]?"boolean"===c.type?"checkbox":"object"===c.type?"fieldset":e.isUndefined(c["enum"])?c.type:"select":"text"),!a.options&&c["enum"]&&(a.options=a.titleMap?e.map(c["enum"],function(b){return{value:b,title:a.titleMap[b]||b}}):c["enum"]),"checkboxes"===a.type&&c.items){var h=c.items["enum"];h&&(c.items._jsonform_checkboxes_as_array=!0),!h&&c.items[0]&&(h=c.items[0]["enum"],h&&(c.items[0]._jsonform_checkboxes_as_array=!0))}"object"===c.type&&e.each(c.properties,function(b,c){d.appendChild(this.buildFromLayout({key:a.key+"."+c}))},this)}if(a.type||(a.type=a.parentNode?"none":"root"),f=k.elementTypes[a.type],!f)throw Error('The JSONForm contains an element whose type is unknown: "'+a.type+'"');if(c){if(!f.inputfield&&!f.array&&"selectfieldset"!==a.type&&"object"!==c.type)throw Error('The JSONForm contains an element that links to an element in the JSON schema (key: "'+a.key+'") '+'and that should not based on its type ("'+a.type+'")')}else if(f.inputfield&&"selectfieldset"!==a.type)throw Error('The JSONForm defines an element of type "'+a.type+'" '+'but no "key" property to link the input field to the JSON schema');return a.iddot=m(a.id||""),d.formElement=a,d.schemaElement=c,d.view=f,d.ownerTree=this,a.handlers||(a.handlers={}),d.view.array?(g=a.items?a.items[0]||a.items:a.key+"[]",e.isString(g)&&(g={key:g}),d.setChildTemplate(this.buildFromLayout(g))):a.items&&e.each(a.items,function(a){e.isString(a)&&(a={key:a}),d.appendChild(this.buildFromLayout(a))},this),d},u.prototype.computeInitialValues=function(){this.root.computeInitialValues(this.formDesc.value)},u.prototype.render=function(a){a&&(this.domRoot=a,this.root.render())},u.prototype.forEachElement=function(a){var b=function(c){for(var d=0;c.children.length>d;d++)a(c.children[d]),b(c.children[d])};b(this.root)},u.prototype.validate=function(a){var b=k.getFormValue(this.domRoot),e=!1,f=this.formDesc;if(f.validate!==!1){var g=!1;if("object"!=typeof f.validate?c.JSONFormValidator&&(g=c.JSONFormValidator.createEnvironment("json-schema-draft-03")):g=f.validate,g){var h=g.validate(b,this.formDesc.schema);d(this.domRoot).jsonFormErrors(!1,f),h.errors.length&&(e||(e=[]),e=e.concat(h.errors))}}return e&&!a&&(f.displayErrors?f.displayErrors(e,this.domRoot):d(this.domRoot).jsonFormErrors(e,f)),{errors:e}},u.prototype.submit=function(a){var b=function(){return a&&(a.preventDefault(),a.stopPropagation()),!1},c=k.getFormValue(this.domRoot),d=this.formDesc,e=!1;if(this.forEachElement(function(b){e||b.view.onSubmit&&(e=!b.view.onSubmit(a,b))}),e)return b();var f=this.validate();return d.onSubmit&&!d.onSubmit(f.errors,c)?b():f.errors?b():d.onSubmitValid&&!d.onSubmitValid(c)?b():!1},k.getFormValue=function(a){var b=d(a).data("jsonform-tree");return b?b.root.getFormValues():null},d.fn.jsonFormErrors=function(a){if(d(".error",this).removeClass("error"),d(".warning",this).removeClass("warning"),d(".jsonform-errortext",this).hide(),a)for(var c=0;a.length>c;c++){var e=a[c].uri.replace(/.*#\//,"").replace(/\//g,".").replace(/\.([0-9]+)(\.|$)/,"[$1]$2"),f=".jsonform-error-"+m(e.replace(/\./g,"---")),g=a[c].type||"error";d(f,this).addClass(g),d(f+" .jsonform-errortext",this).html(a[c].message).show()}},d.fn.jsonForm=function(a){var b=this;a=a||{};var c=new u;return c.initialize(a),c.render(b.get(0)),a.transloadit&&b.append('<input type="hidden" name="params" value=\''+l(f.stringify(a.transloadit.params))+"'>"),b.data("jsonform-tree",c),b.unbind((a.submitEvent||"submit")+".jsonform"),b.bind((a.submitEvent||"submit")+".jsonform",function(a){c.submit(a)}),n(b),d(".expandable > div, .expandable > fieldset",b).hide(),d(".expandable > legend",b).click(function(){var a=d(this).parent();a.toggleClass("expanded"),d("> div",a).slideToggle(100)}),c},d.fn.jsonFormValue=function(){return k.getFormValue(this)},c.JSONForm=c.JSONForm||{util:{}},c.JSONForm.getFormValue=k.getFormValue,c.JSONForm.fieldTemplate=k.fieldTemplate,c.JSONForm.fieldTypes=k.elementTypes,c.JSONForm.getInitialValue=s,c.JSONForm.util.getObjKey=k.util.getObjKey,c.JSONForm.util.setObjKey=k.util.setObjKey}(b!==void 0,b!==void 0?b:window,c!==void 0?c:{fn:{}},"undefined"!=typeof _?_:null,JSON)}});